<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/pro.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Document</title>
</head>

<body>
  <div class="background"></div>
  <header>
    <div class="logo">
      <img src="/assets/цемент.png" alt="Логотип Монолит">
    </div>
    <div class="contact-info">
      <p><i class="fas fa-phone"></i> +7 (903) 888-78-11</p>
      <p><i class="fas fa-map-marker-alt"></i> ул. Станкостроителей, д.1, Иваново</p>
      <p><i class="fas fa-envelope"></i> <a href="mailto:monolith@info.ru">monolith@info.ru</a></p>
    </div>
    <nav>
      <a href="/">Главная</a>
      <a href="/order">Заказ</a>
      <a href="/catalog">Категории товара</a>
      <a href="/register">Регистрация</a>
      <a href="/pro">Профиль</a>
    </nav>
  </header>
  <div class="content">
    <div class="wrapper">
      <form action="#">
        <h2>Вход</h2>
        <div class="input-field">
          <input type="text" required>
          <label>Введите вашу почту</label>
        </div>
        <div class="input-field">
          <input type="password" required>
          <label>Введите ваш пароль</label>
        </div>
        <div class="forget">
          <label for="remember">
            <input type="checkbox" id="remember">
            <p>Запомнить меня </p>
          </label>
          <a href="#">Забыли пароль?</a>
        </div>
        <button type="submit">Войти</button>
        <div class="register">
          <p>Еще нет аккаунта? <a href="/html/register.html">Регистрация</a></p>
        </div>
      </form>
      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Пароль" required>
        <button type="submit">Войти</button>
      </form>
      <script>
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          try {
            const response = await fetch('http://localhost:3000/api/users/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, password }),
            });
            const data = await response.json();
            if (response.ok) {
              localStorage.setItem('user', JSON.stringify(data.user));
              alert('Вход успешен!');
              location.reload();
            } else {
              alert(data.error);
            }
          } catch (error) {
            alert('Ошибка при входе');
          }
        });
      </script>
      <div id="orders"></div>
      <script>
        async function loadOrders() {
          const user = JSON.parse(localStorage.getItem('user'));
          if (!user) {
            document.getElementById('orders').innerHTML = '<p>Пожалуйста, войдите в аккаунт</p>';
            return;
          }
          const response = await fetch(`http://localhost:3000/api/orders/user/${user.id}`);
          const orders = await response.json();
          const ordersDiv = document.getElementById('orders');
          ordersDiv.innerHTML = orders.map(order => `
            <div class="order">
                <p>Тип бетона: ${order.concreteType}</p>
                <p>Объём: ${order.volume} м³</p>
                <p>Доставка: ${order.deliveryType}</p>
                <p>Цена: ${order.price} руб.</p>
                <p>Статус: ${order.status}</p>
            </div>
        `).join('');
        }
        loadOrders();
      </script>
    </div>
  </div>
</body>

</html>